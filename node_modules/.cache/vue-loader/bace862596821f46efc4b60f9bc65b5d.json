{"remainingRequest":"/Users/liangzexiang/WebstormProjects/ays/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/liangzexiang/WebstormProjects/ays/src/views/marketing/instalvide.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/liangzexiang/WebstormProjects/ays/src/views/marketing/instalvide.vue","mtime":1594579913135},{"path":"/Users/liangzexiang/WebstormProjects/ays/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/liangzexiang/WebstormProjects/ays/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liangzexiang/WebstormProjects/ays/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nvar app0\n\nimport {\n    del,\n    GetDataByList,\n    GetQueryBydownload,\n} from '@/api/marketing'\nimport waves from '@/directive/waves'\nimport  MarForm from './marketing/form'\nimport  tingFrom from './marketing/marketing'\n\nimport {getArrByKey, pickerOptions} from '@/utils'\nimport {mapGetters} from 'vuex'\n\nimport {regionDataPlus} from 'element-china-area-data'\n\n\nexport default {\n    name: 'Roles',\n    // components: { rolesForm },\n    directives: {\n        waves\n    },\n    components: {MarForm,tingFrom},\n    filters: {\n        statusFilter(status) {\n            const statusMap = {\n                0: '禁用',\n                1: '正常'\n            }\n            return statusMap[status]\n        }\n    },\n    data() {\n        return {\n            isIndeterminate: true,\n            checkedCities: [], // 已选择\n            checkAll: false,\n            dialogAudit: false,\n            loading: true,\n            sumorder: 0,\n            reTitle: '',\n\n\n            infodialogVisible: false, // 打开详情\n            reOption: [],\n            is_disabled: false,\n            shopQuery: {\n                cityCode: undefined,\n                shopname: undefined,\n                tel: undefined\n            },\n            postFrom: {},\n            permissions: [], // 权限组\n            RedialogVisible: false,\n            ReturndialogVisible: false,\n            ReturnData: {\n                type: 1,\n                price: undefined,\n                courier: undefined,\n                courier_order_no: undefined,\n                name: undefined\n            },\n            innerVisible: false,\n            dialogVisible: false,\n            checked: true,\n            tableKey: 0,\n\n            list: null,\n            total: 0,\n\n            //\n            selectedRows: null,\n            listLoading: true,\n            showSearch: false,\n            options: [],\n            shop: [],\n            listQuery: {\n                page: 1,\n                limit: 10,\n                status: 'all',\n                title: '',\n                sstatus: 'all'\n            },\n            allsum: 0,\n            countdata: [\n                {\n                    total: 1,\n                    status: 1\n                },\n                {\n                    total: 1,\n                    status: 1\n                },\n                {\n                    total: 1,\n                    status: 1\n                },\n\n            ],\n            buttonDisabled: true,\n            deleting: false,\n            pickerOptions: pickerOptions,\n            currentIndex: -1,\n            regionHiera: [],\n            Stitle: '',\n            checklist: []\n        }\n    },\n    computed: {\n        ...mapGetters(['userinfo', 'brand', 'group'])\n    },\n    watch: {},\n    created() {\n        this.permissions = this.group.btn.split(',')\n        this.fetchList()\n    },\n\n    methods: {\n\n        handleRelease(row){\n            this.$refs.tingfrom.handleEdit(row)\n        },\n        // 导出数据\n        handleDownload() {\n            // this.downloadLoading = true\n            GetQueryBydownload(this.listQuery).then(res => {\n                import('@/vendor/Export2Excel').then(excel => {\n                    console.log(excel)\n                    const tHeader = [\n                        '安装单号',\n                        '订单状态',\n                        '购买平台',\n                        '购买单号',\n                        '购买账号',\n                        '购买产品',\n                        '订单金额',\n                        '联系人',\n                        '联系电话',\n                        '省',\n                        '市',\n                        '区',\n                        '详细地址',\n                        '车牌号',\n                        '车型',\n                        '备注',\n                        '提交时间',\n                        '门店类别',\n                        '门店状态',\n                        '有无宝典',\n                        '门店名称',\n                        '门店地址',\n                        '门店电话',\n                        '安装费用',\n                        '主业务员',\n                        '次业务员',\n                        '客服',\n                        '客服备注',\n                        '派单时间',\n                        '业务确认时间',\n                        '门店确认时间',\n                        '安装完成时间',\n                        '结算时间',\n                        '结算方式',\n                        '是否驳回',\n                        '驳回原因',\n                        '回访',\n                        '售后'\n                    ]\n                    const filterVal = [\n                        'id',\n                        'status',\n                        'lazada_title',\n                        'buy_order_no',\n                        'buy_account',\n                        'product_titile',\n                        'no_price',\n                        'contact',\n                        'tel',\n                        'city_province',\n                        'city_city',\n                        'city_carea',\n                        'city_desc',\n                        'number_plate',\n                        'model_title',\n                        'desc',\n                        'create_time',\n                        'shop_type',\n                        'shop_status',\n                        'is_book',\n                        'shop_name',\n                        'shop_city',\n                        'shop_tel',\n                        'ins_cost',\n                        'sales_name',\n                        'insales_name',\n                        'pre_name',\n                        'service_desc',\n                        'send_time',\n                        'business_time',\n                        'stores_time',\n                        'install_time',\n                        'settlement_time',\n                        'settlement_type',\n                        'is_rejected',\n                        'rejected_txt',\n                        'return',\n                        'after_sales'\n                    ]\n                    const data = this.formatJson(res.data.data, filterVal)\n\n                    var day2 = new Date()\n                    day2.setTime(day2.getTime())\n                    var s2 =\n                        day2.getFullYear() +\n                        '-' +\n                        (day2.getMonth() + 1) +\n                        '-' +\n                        day2.getDate()\n                    excel.export_json_to_excel({\n                        header: tHeader,\n                        data,\n                        filename: s2\n                    })\n                    this.downloadLoading = false\n                })\n            })\n        },\n        formatJson(data, filterVal) {\n            return data.map(v =>\n                filterVal.map(j => {\n                    if (j === 'timestamp') {\n                        return parseTime(v[j])\n                    } else {\n                        return v[j]\n                    }\n                })\n            )\n        },\n\n        rolesbtn(val) {\n            var index = this.permissions.indexOf(val)\n            if (index > -1) {\n                return true\n            } else {\n                return false\n            }\n        },\n        handeldownload() {\n            this.$message('暂无导出')\n        },\n\n        // 打开详情\n        handelInfo(row) {\n            this.postFrom = row\n            if (row.city_code.constructor === String) {\n                this.postFrom.city_code = this.postFrom.city_code.split(',')\n            }\n            if (row.car_model.constructor === String) {\n                this.postFrom.car_model = this.postFrom.car_model.split(',')\n            }\n            if (row.lazada_list.constructor === String) {\n                this.postFrom.lazada_list = this.postFrom.lazada_list.split(',')\n            }\n            const lazada = this.postFrom.lazada_list\n            this.postFrom.lazada_list = []\n\n            for (let i = 0; i < lazada.length; i++) {\n                this.postFrom.lazada_list.push(parseInt(lazada[i]))\n            }\n            this.infodialogVisible = !this.infodialogVisible\n        },\n        // 所选门店\n        fetchList() {\n            this.listLoading = true\n            GetDataByList(this.listQuery).then(response => {\n                this.list = response.data.data\n                this.total = response.data.total\n                let countdata = response.data.coudata\n                var temp = []\n                var allsum = 0\n                for (let i = 0; i < 13; i++) {\n                    temp.push({ total: 0, status: i })\n                }\n                console.log(countdata)\n                for (let i = 0; i < countdata.length; i++) {\n                    allsum = allsum + countdata[i].total\n                    temp[countdata[i].status].total = countdata[i].total\n                    if (countdata[i].status === 9) {\n                        if (temp[0].total === 0) {\n                            temp[0].total = countdata[i].total\n                        } else {\n                            temp[0].total = temp[0].total + countdata[i].total\n                        }\n                    }\n                }\n\n                this.listLoading = !this.listLoading\n                this.allsum = allsum\n                console.log(temp)\n                this.countdata = temp\n\n                this.listLoading = !this.listLoading\n                this.listLoading = false\n            })\n        },\n        handleFilter() {\n            this.listQuery.page = 1\n            this.fetchList()\n        },\n\n        handleSizeChange(val) {\n            this.listQuery.psize = val\n            this.fetchList()\n        },\n\n        handleStatusChange(val) {\n            this.listQuery.page = 1\n            this.listQuery.status = val\n            this.fetchList()\n        },\n        handleCurrentChange(val) {\n            this.listQuery.page = val\n            this.fetchList()\n        },\n\n        handleUpdate(row) {\n            this.$refs.marform.handleView(row)\n        },\n\n        handleDelete(index, id) {\n            const _this = this\n            this.$confirm('此操作将永久删除该记录, 是否继续?', '提示', {\n                confirmButtonText: '确定',\n                cancelButtonText: '取消',\n                type: 'warning'\n            })\n                .then(() => {\n                    _this.$set(_this.list[index], 'delete', true)\n                    del(id)\n                        .then(response => {\n                            if (response.status === 1) {\n                                _this.list.splice(index, 1)\n                                _this.total = _this.total - 1\n                                _this.$notify.success(response.msg)\n                                this.fetchList()\n                            } else {\n                                _this.$notify.error(response.msg)\n                            }\n                            _this.$set(_this.list[index], 'delete', false)\n                        })\n                        .catch(error => {\n                            _this.$set(_this.list[index], 'delete', false)\n                        })\n                })\n                .catch(() => {\n                    this.$message({\n                        type: 'info',\n                        message: '已取消删除'\n                    })\n                })\n        },\n    }\n}\n",null]}