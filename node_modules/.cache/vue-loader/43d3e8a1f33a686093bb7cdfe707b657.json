{"remainingRequest":"/Users/liangzexiang/WebstormProjects/ays/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/liangzexiang/WebstormProjects/ays/src/views/manage/admin/form.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/liangzexiang/WebstormProjects/ays/src/views/manage/admin/form.vue","mtime":1587402564000},{"path":"/Users/liangzexiang/WebstormProjects/ays/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liangzexiang/WebstormProjects/ays/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liangzexiang/WebstormProjects/ays/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/liangzexiang/WebstormProjects/ays/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liangzexiang/WebstormProjects/ays/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n// import Upload from '@/components/Upload/oneImage'\nimport { getListAll } from '@/api/roles'\nimport { getinfo, save } from '@/api/admin'\nimport { formatImgToArr, getNowTime } from '@/utils'\nimport { validatePhone, validateEmail } from '@/utils/validate'\nimport myconfig from '@/config'\n\nexport default {\n  name: 'AdminForm',\n  // components: { Upload },\n  data() {\n\n    var checkEmail = (rule, value, callback) => {\n      if (validateEmail(value)) {\n        callback()\n      } else {\n        return callback(new Error())\n      }\n    }\n    return {\n      btnLoading: false,\n      roles: {},\n      temp: {\n        id: 0,\n        groupId: '',\n        userName: '',\n        password: '',\n        realName: '',\n        isEnabled: 1,\n        phone: '',\n        email: '',\n        regTime: getNowTime(),\n        img: ''\n      },\n      oss_url:'',\n      config: {\n        fileName: 'img',\n        limit: 1,\n        multiple: true,\n        accept: 'image/*',\n        action: myconfig.uploadUrl.img\n      },\n      dialogFormVisible: false,\n      dialogStatus: '',\n      textMap: {\n        update: '编辑',\n        create: '添加'\n      },\n      rules: {\n        groupId: [{ required: true, message: '角色必选', trigger: 'change' }],\n        userName: [{ required: true, message: '账号必填', trigger: 'blur' }],\n        // phone: [{ validator: checkPhone, message: '手机号格式错误', trigger: 'blur' }],\n        email: [{ validator: checkEmail, message: '邮箱格式错误', trigger: 'blur' }]\n      }\n\n    }\n  },\n  watch: {\n    dialogFormVisible: function() {\n      this.resetTemp()\n    },\n    temp: {\n      handler(newVal, oldVal) {},\n      immediate: true,\n      deep: true\n    }\n  },\n  created() {\n    this.getRoles()\n  },\n  destroyed() {\n\n  },\n  methods: {\n    handelFile(e){\n      const _this = this\n      _this.temp.img=e.file.url\n    },\n    getRoles() {\n      getListAll().then(response => {\n        this.roles = response.data\n      })\n    },\n    resetTemp() {\n      this.temp = {\n        id: 0,\n        groupId: '',\n        userName: '',\n        password: '',\n        realName: '',\n        isEnabled: 1,\n        phone: '',\n        email: '',\n        regTime: getNowTime(),\n        img: ''\n      }\n    },\n    handleCreate() {\n      this.dialogStatus = 'create'\n      this.dialogFormVisible = true\n      this.currentIndex = -1\n      this.$nextTick(() => {\n        this.$refs['dataForm'].clearValidate()\n      })\n    },\n    handleUpdate(id) {\n      this.oss_url=myconfig.oss_url\n      this.dialogStatus = 'update'\n      this.dialogFormVisible = true\n      const _this = this\n      getinfo(id).then(response => {\n        if (response.status === 1) {\n          _this.temp.id = response.data.id\n          _this.temp.groupId = response.data.groupId\n          _this.temp.userName = response.data.userName\n          _this.temp.realName = response.data.realName\n          _this.temp.isEnabled = response.data.isEnabled\n          _this.temp.phone = response.data.phone\n          _this.temp.email = response.data.email\n          _this.temp.password = ''\n          _this.temp.img =response.data.img\n        }\n      })\n      this.$nextTick(() => {\n        this.$refs['dataForm'].clearValidate()\n      })\n    },\n    saveData() {\n      this.btnLoading = true\n      console.log('更新')\n      this.$refs['dataForm'].validate((valid) => {\n        if (valid) {\n          const _this = this\n          const d = this.temp\n          if (typeof (d.img) === 'object') {\n            d.img = d.img.join(',')\n          }\n\n          save(d).then(response => {\n            if (response.status === 1) {\n              if (!d.id) {\n                d.id = response.data.id\n              }\n              // todo\n              this.$emit('updateRow', d)\n              _this.dialogFormVisible = false\n              _this.$message.success(response.msg)\n            } else {\n              _this.$message.error(response.msg)\n            }\n            _this.btnLoading = false\n          }).catch((error) => {\n            this.btnLoading = false\n          })\n        } else {\n          this.btnLoading = false\n        }\n      })\n    }\n  }\n}\n",null]}