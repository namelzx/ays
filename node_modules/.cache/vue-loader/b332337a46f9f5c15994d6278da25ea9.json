{"remainingRequest":"/Users/liangzexiang/WebstormProjects/ays/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/liangzexiang/WebstormProjects/ays/src/views/cost/operate.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/liangzexiang/WebstormProjects/ays/src/views/cost/operate.vue","mtime":1596991000384},{"path":"/Users/liangzexiang/WebstormProjects/ays/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liangzexiang/WebstormProjects/ays/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/liangzexiang/WebstormProjects/ays/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liangzexiang/WebstormProjects/ays/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nvar app0\n\nimport {\n  change,\n  changeAll,\n  del,\n  delAll,\n  GetDataByList,\n  GetQueryBydownload,\n  PostDataByAdd,\n  PostNoteByAdd,\n  PostReturnedByAdd\n} from '@/api/costorder'\nimport waves from '@/directive/waves'\nimport { getArrByKey, pickerOptions } from '@/utils'\nimport { mapGetters } from 'vuex'\n\n// import sendOrder from \"./install/sendOrder\";\nimport sendOper from './install/sendOper'\n\n// import OrderInfo from \"./install/OrderInfo\";\nimport OrderInfocost from './install/OrderInfocost'\n\nimport Audit from './install/costaudit'\nimport { CarBrand } from '@/api/tools'\nimport { GetecshopByList } from '@/api/ecshop'\nimport { GetDataByShopAll } from '@/api/shop'\nimport { GetSaleByAll } from '@/api/salesman'\nimport { regionDataPlus } from 'element-china-area-data'\n\nexport default {\n  name: 'Operate',\n  // components: { rolesForm },\n  directives: {\n    waves\n  },\n  components: {\n    sendOper,\n    OrderInfocost,\n    Audit\n  },\n  filters: {\n    statusFilter(status) {\n      const statusMap = {\n        0: '禁用',\n        1: '正常'\n      }\n      return statusMap[status]\n    }\n  },\n  data() {\n    return {\n      isIndeterminate: true,\n      checkedCities: [], // 已选择\n      checkAll: false,\n      dialogAudit: false,\n      loading: true,\n      sumorder: 0,\n      productTree: [], // 产品树\n      reTitle: '',\n      reFrom: {\n        role: 2,\n        type: 1\n      },\n      after: [\n        {\n          lable: '已售后',\n          value: 1\n        },\n        {\n          lable: '未售后',\n          value: 2\n        }\n      ],\n\n      orderStatus: [\n        {\n          lable: '全部',\n          value: 'all'\n        },\n        {\n          lable: '待初审',\n          value: 1\n        },\n        {\n          lable: '待财审1',\n          value: 2\n        },\n        {\n          lable: '待财审2',\n          value: 3\n        },\n        {\n          lable: '待结算',\n          value: 4\n        },\n        {\n          lable: '已结算',\n          value: 5\n        },\n        {\n          lable: '驳回',\n          value: 6,\n          total:0,\n        }\n      ],\n      visit: [\n        {\n          lable: '已回访',\n          value: 1\n        },\n        {\n          lable: '未回访',\n          value: 2\n        }\n      ],\n      infodialogVisible: false, // 打开详情\n      reOption: [],\n      is_disabled: false,\n      shopQuery: {\n        cityCode: undefined,\n        shopname: undefined,\n        tel: undefined\n      },\n      postFrom: {},\n      permissions: [], // 权限组\n      RedialogVisible: false,\n      ReturndialogVisible: false,\n      ReturnData: {\n        type: 1,\n        price: undefined,\n        courier: undefined,\n        courier_order_no: undefined,\n        name: undefined\n      },\n      innerVisible: false,\n      dialogVisible: false,\n      checked: true,\n      tableKey: 0,\n      order_id: undefined,\n      CarModellist: [], // 车型数据\n      lazada: [], // 所有平台\n      salesman: [], // 所有业务员\n      device: [], // 装置罩\n      carl: [],\n      list: null,\n      total: 0,\n\n      // postFrom: Object.assign({}, defaultForm),\n      cityoptions: regionDataPlus, // 地址\n      selectedRows: null,\n      listLoading: true,\n      showSearch: false,\n      order_id: undefined,\n\n      options: [],\n      shop: [],\n      listQuery: {\n        page: 1,\n        limit: 10,\n        status: 'all',\n        title: '',\n        sstatus: 'all'\n      },\n      allsum: 0,\n      countdata: [\n        {\n          total: 1,\n          status: 1\n        },\n        {\n          total: 1,\n          status: 1\n        },\n        {\n          total: 1,\n          status: 1\n        },\n        {\n          total: 1,\n          status: 1\n        },\n        {\n          total: 1,\n          status: 1\n        },\n        {\n          total: 1,\n          status: 1\n        },\n        {\n          total: 1,\n          status: 1\n        }\n      ],\n      buttonDisabled: true,\n      deleting: false,\n      pickerOptions: pickerOptions,\n      currentIndex: -1,\n      regionHiera: [],\n      Stitle: '',\n      checklist: []\n    }\n  },\n  computed: {\n    ...mapGetters(['userinfo', 'brand', 'group'])\n  },\n  watch: {},\n  created() {\n    this.permissions = this.group.btn.split(',')\n    this.fetchList()\n    if (this.brand === undefined) {\n      CarBrand().then(res => {\n        this.regionHiera = res.data\n      })\n    } else {\n      this.regionHiera = this.brand\n    }\n    GetecshopByList().then(res => {\n      this.lazada = res.data\n    })\n\n    console.log(this.userinfo)\n    // 产品树\n\n    GetDataByShopAll().then(res => {\n      this.shop = res.data\n    })\n\n    GetSaleByAll().then(res => {\n      this.salesman = res.data\n    })\n  },\n\n  methods: {\n    handelcheck(e) {\n      var index = this.checklist.indexOf(e)\n      console.log(index)\n      if (index === -1) {\n        this.checklist.push(e)\n      } else {\n        this.checklist.splice(index, 1)\n      }\n      if (this.checklist.length === this.list.length) {\n        this.isIndeterminate = true\n        this.checkAll = true\n      }\n    },\n    handleCheckAllChange(val) {\n      this.checkedCities = this.list.length ? this.checklist.length : []\n      this.isIndeterminate = false\n    },\n    handleCheckedCitiesChange(value) {\n      const checkedCount = value.length\n      this.checkAll = checkedCount === this.cities.length\n      this.isIndeterminate =\n        checkedCount > 0 && checkedCount < this.cities.length\n    },\n    handleCloseAudit() {\n      this.dialogAudit = false\n      this.fetchList()\n    },\n    handeReturn() {\n      // this.$message('暂未编写退货逻辑')\n      this.ReturnData.order_id = this.order_id\n      PostReturnedByAdd(this.ReturnData).then(res => {\n        this.ReturndialogVisible = !this.ReturndialogVisible\n        this.fetchList()\n      })\n    },\n    // 导出数据\n    handleDownload() {\n      // this.downloadLoading = true\n      GetQueryBydownload(this.listQuery).then(res => {\n        import('@/vendor/Export2Excel').then(excel => {\n          console.log(excel)\n          const tHeader = [\n            '安装单号',\n            '订单状态',\n            '购买平台',\n            '购买单号',\n            '购买账号',\n            '购买产品',\n            '订单金额',\n            '联系人',\n            '联系电话',\n            '省',\n            '市',\n            '区',\n            '详细地址',\n            '车牌号',\n            '车型',\n            '备注',\n            '提交时间',\n            '门店类别',\n            '门店状态',\n            '有无宝典',\n            '门店名称',\n            '门店地址',\n            '门店电话',\n            '安装费用',\n            '主业务员',\n            '次业务员',\n            '客服',\n            '客服备注',\n            '派单时间',\n            '业务确认时间',\n            '门店确认时间',\n            '安装完成时间',\n            '结算时间',\n            '结算方式',\n            '是否驳回',\n            '驳回原因',\n            '回访',\n            '售后'\n          ]\n          const filterVal = [\n            'id',\n            'status',\n            'lazada_title',\n            'buy_order_no',\n            'buy_account',\n            'product_titile',\n            'no_price',\n            'contact',\n            'tel',\n            'city_province',\n            'city_city',\n            'city_carea',\n            'city_desc',\n            'number_plate',\n            'model_title',\n            'desc',\n            'create_time',\n            'shop_type',\n            'shop_status',\n            'is_book',\n            'shop_name',\n            'shop_city',\n            'shop_tel',\n            'ins_cost',\n            'sales_name',\n            'insales_name',\n            'pre_name',\n            'service_desc',\n            'send_time',\n            'business_time',\n            'stores_time',\n            'install_time',\n            'settlement_time',\n            'settlement_type',\n            'is_rejected',\n            'rejected_txt',\n            'return',\n            'after_sales'\n          ]\n          const data = this.formatJson(res.data.data, filterVal)\n\n          var day2 = new Date()\n          day2.setTime(day2.getTime())\n          var s2 =\n            day2.getFullYear() +\n            '-' +\n            (day2.getMonth() + 1) +\n            '-' +\n            day2.getDate()\n          excel.export_json_to_excel({\n            header: tHeader,\n            data,\n            filename: s2\n          })\n          this.downloadLoading = false\n        })\n      })\n    },\n    formatJson(data, filterVal) {\n      return data.map(v =>\n        filterVal.map(j => {\n          if (j === 'timestamp') {\n            return parseTime(v[j])\n          } else {\n            return v[j]\n          }\n        })\n      )\n    },\n    handleReturn(row) {\n      this.ReturndialogVisible = !this.ReturndialogVisible\n      this.reTitle = row.id + ' ' + '退货操作'\n      this.order_id = row.id\n    },\n    handleRe() {\n      this.RedialogVisible = !this.RedialogVisible\n    },\n    rolesbtn(val) {\n      var index = this.permissions.indexOf(val)\n      if (index > -1) {\n        return true\n      } else {\n        return false\n      }\n    },\n    handeldownload() {\n      this.$message('暂无导出')\n    },\n    handelInfoDialog() {\n      this.infodialogVisible = !this.infodialogVisible\n    },\n    // 打开详情\n    handelInfo(row) {\n      this.postFrom = row\n      // if (row.city_code.constructor === String) {\n      //   this.postFrom.city_code = this.postFrom.city_code.split(\",\");\n      // }\n      // if (row.car_model.constructor === String) {\n      //   this.postFrom.car_model = this.postFrom.car_model.split(\",\");\n      // }\n      // if (row.lazada_list.constructor === String) {\n      //   this.postFrom.lazada_list = this.postFrom.lazada_list.split(\",\");\n      // }\n      // let lazada = this.postFrom.lazada_list;\n      // this.postFrom.lazada_list = [];\n\n      // for (let i = 0; i < lazada.length; i++) {\n      //   this.postFrom.lazada_list.push(parseInt(lazada[i]));\n      // }\n      this.infodialogVisible = !this.infodialogVisible\n    },\n    handelPostRe() {\n      this.reFrom.admin_id = this.userinfo.id\n\n      this.reFrom.tocontent =\n        '订单驳回' +\n        '  ' +\n        this.userinfo.realName +\n        '-' +\n        this.userinfo.group.title +\n        ' 驳回订单,' +\n        ' ' +\n        this.reFrom.content\n      PostNoteByAdd(this.reFrom).then(res => {\n        this.fetchList()\n        this.RedialogVisible = !this.RedialogVisible\n      })\n    },\n    // 驳回\n    handelRejected(row) {\n      var type = row.status\n      this.RedialogVisible = !this.RedialogVisible\n      this.reFrom.order_id = row.id\n      this.reFrom.model_title = row.model_title\n      this.reFrom.product_titile = row.product_titile\n      this.reFrom.shopname = row.shop.shopname\n      this.reFrom.admin_name = this.userinfo.realName\n      this.reFrom.openid = row.openid\n      this.reFrom.rejected = row.status\n      this.reFrom.salesman_id = row.salesman_id\n      this.reTitle = row.id + '-' + row.status + ' ' + '驳回原因'\n      var option = []\n\n      this.reOption = option\n    },\n    // 所选门店\n    fetchList() {\n      this.listLoading = true\n      GetDataByList(this.listQuery).then(response => {\n        this.list = response.data.data\n        console.log(response.data.data, 'shuju')\n        this.total = response.data.total\n        const countdata = response.data.countdata\n        console.log(countdata)\n\n        var temp = []\n        var allsum = 0\n        for (let i = 0; i < 13; i++) {\n          temp.push({ total: 0, status: i })\n        }\n        for (let i = 0; i < countdata.length; i++) {\n          allsum = allsum + countdata[i].total\n          temp[countdata[i].status].total = countdata[i].total\n          if (countdata[i].status === 9) {\n            if (temp[0].total === 0) {\n              temp[0].total = countdata[i].total\n            } else {\n              temp[0].total = temp[0].total + countdata[i].total\n            }\n          }\n        }\n\n        this.listLoading = !this.listLoading\n        this.allsum = allsum\n        this.countdata = temp\n        this.listLoading = false\n      })\n    },\n    handleFilter() {\n      this.listQuery.page = 1\n      this.fetchList()\n    },\n    handleFilterClear() {\n      this.listQuery = {\n        page: 1,\n        psize: 10,\n        status: '-1',\n        title: ''\n      }\n      this.fetchList()\n    },\n    handleSizeChange(val) {\n      this.listQuery.psize = val\n      this.fetchList()\n    },\n\n    handleStatusChange(val) {\n      this.listQuery.page = 1\n      this.listQuery.sstatus = val\n      this.fetchList()\n    },\n    handleCurrentChange(val) {\n      this.listQuery.page = val\n      this.fetchList()\n    },\n    handleModifyStatus(index, id, status) {\n      this.list[index]['status'] = 1 - status\n      change(id, 'status', 1 - status).then(response => {})\n    },\n    handleSelectionChange(val) {\n      if (val.length > 0) {\n        this.buttonDisabled = false\n      } else {\n        this.buttonDisabled = true\n      }\n      this.selectedRows = val\n    },\n\n    handleCreate() {\n      this.postFrom = {}\n      this.is_disabled = false\n      this.Stitle = '新增支付单'\n      this.postFrom.status = '待初审'\n\n      this.dialogVisible = !this.dialogVisible\n    },\n    handleUpdate(row) {\n      this.postFrom = {}\n      this.postFrom = row\n\n\n      this.is_disabled = false\n\n      if (this.postFrom.status === '驳回') {\n        this.postFrom.status = '重新派单'\n      }\n\n      this.Stitle = this.postFrom.id + '-' + this.postFrom.status + '操作'\n\n      this.dialogAudit = !this.dialogAudit\n    },\n\n    handleEdit(row) {\n      this.postFrom = {}\n      this.postFrom = row\n\n      this.is_disabled = false\n\n      if (this.postFrom.status === '驳回') {\n        this.postFrom.status = '重新派单'\n      }\n      if (row.lazada_list.constructor === String) {\n        this.postFrom.lazada_list = this.postFrom.lazada_list.split(\",\");\n      }\n      let lazada_list=[]\n      this.postFrom.lazada_list.forEach(item=>{\n        lazada_list.push(parseInt(item))\n      })\n      this.postFrom.lazada_list=lazada_list\n      console.log( this.postFrom.lazada_list)\n\n      this.postFrom.status = '修改'\n      this.postFrom.imglist=this.postFrom.imglist.split(',')\n      let img=[];\n      this.postFrom.imglist.forEach(item=>{\n        img.push({url:item})\n      })\n      this.postFrom.imglist=img\n      this.Stitle = '修改操作'\n    console.log(this.postFrom)\n      this.dialogVisible = !this.dialogVisible\n    },\n    handleClose() {\n      this.dialogVisible = !this.dialogVisible\n      this.fetchList()\n    },\n\n    handleDelete(index, id) {\n      const _this = this\n      this.$confirm('此操作将永久删除该记录, 是否继续?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      })\n        .then(() => {\n          _this.$set(_this.list[index], 'delete', true)\n          del(id)\n            .then(response => {\n              if (response.status === 1) {\n                _this.list.splice(index, 1)\n                _this.total = _this.total - 1\n                _this.$notify.success(response.msg)\n                this.fetchList()\n              } else {\n                _this.$notify.error('删除成功')\n              }\n              _this.$notify.error('删除成功')\n              _this.$set(_this.list[index], 'delete', false)\n            })\n            .catch(error => {\n              _this.$set(_this.list[index], 'delete', false)\n            })\n        })\n        .catch(() => {\n          this.$message({\n            type: 'info',\n            message: '已取消删除'\n          })\n        })\n    },\n    handleDeleteAll() {\n      const _this = this\n      if (this.selectedRows.length > 0) {\n        this.$confirm('此操作将永久删除该记录, 是否继续?', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        })\n          .then(() => {\n            _this.deleting = true\n            const ids = getArrByKey(_this.selectedRows, 'id')\n            const idstr = ids.join(',')\n            delAll({ ids: idstr })\n              .then(response => {\n                if (response.status === 1) {\n                  const delindex = []\n                  _this.list.forEach(function(item, index, input) {\n                    if (ids.indexOf(item.id) > -1) {\n                      delindex.push(index)\n                    }\n                  })\n                  for (let i = delindex.length - 1; i >= 0; i--) {\n                    _this.list.splice(delindex[i], 1)\n                  }\n                  _this.total = _this.total - delindex.length\n                  _this.$message.success(response.msg)\n                } else {\n                  _this.$message.error(response.msg)\n                }\n                _this.deleting = false\n              })\n              .catch(error => {\n                _this.deleting = false\n              })\n          })\n          .catch(() => {\n            this.$message({\n              type: 'info',\n              message: '已取消删除'\n            })\n          })\n      } else {\n        _this.$message.error('请选择要删除的数据')\n      }\n    },\n    handleCommand(command) {\n      const _this = this\n      if (this.selectedRows.length > 0) {\n        const ids = getArrByKey(this.selectedRows, 'id')\n        const idstr = ids.join(',')\n        changeAll({ val: idstr, field: 'status', value: command })\n          .then(response => {\n            if (response.status === 1) {\n              _this.list.forEach(function(item, index, input) {\n                if (ids.indexOf(item.id) > -1) {\n                  _this.list[index]['status'] = command\n                }\n              })\n              _this.$message.success(response.msg)\n            } else {\n              _this.$message.error(response.msg)\n            }\n          })\n          .catch(error => {})\n      } else {\n        _this.$message.error('请选择要操作的数据')\n      }\n    }\n  }\n}\n",null]}