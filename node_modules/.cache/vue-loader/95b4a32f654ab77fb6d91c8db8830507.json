{"remainingRequest":"/Users/liangzexiang/WebstormProjects/ays/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/liangzexiang/WebstormProjects/ays/src/views/order/install/sendOrder.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/liangzexiang/WebstormProjects/ays/src/views/order/install/sendOrder.vue","mtime":1597166569285},{"path":"/Users/liangzexiang/WebstormProjects/ays/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liangzexiang/WebstormProjects/ays/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/liangzexiang/WebstormProjects/ays/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liangzexiang/WebstormProjects/ays/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n// import { CarBrand } from \"@/api/tools\";\n\nimport {getBrand, getSeries, getModel} from \"@/api/tools\";\n\nimport {GetSaleByAll} from \"@/api/salesman\";\nimport {adminall} from \"@/api/admin\";\n\nimport ShList from \"@/components/shop/index\";\n\nimport {regionDataPlus} from \"element-china-area-data\";\nimport {mapGetters} from \"vuex\";\nimport {GetDataByList, GetDataByShopAll} from \"@/api/shop\";\nimport {Citylist} from \"@/api/city\";\n\nimport {change, changeAll, del, delAll, PostDataByAdd} from \"@/api/order\";\n\nimport {GetecshopByList} from \"@/api/ecshop\";\nimport {getArrByKey, pickerOptions} from \"@/utils\";\nimport {GetProductByTree} from \"@/api/product\";\nimport openWindow from '@/utils/openWindow'\nimport {GetModelIdByInfo, importCarLamp,GetCarlampInfo} from \"@/api/carlamp\";\n    let sel=this;\nconst defaultForm = {\n    logcontent: \"\",\n    openid: \"oQJN40ldFZYLvqoIZm3NGwFu8oKA\",\n    lazada_id: \"\",\n    lazada_list: \"\",\n    lazada_index: \"\",\n    buy_order_no: \"12123\",\n    buy_account: \"199\",\n    buy_product_id: \"\",\n    no_price: \"199\",\n    contact: \"梁泽祥\",\n    tel: \"18677947067\",\n    city_code: undefined,\n    city_desc: \"\",\n    number_plate: \"A871237\",\n    car_model: undefined,\n    car_index: \"\",\n    car_model_id: \"\"\n};\n\nexport default {\n    name: \"sendOrder\",\n    data() {\n        return {\n            hang: [\n                {\n                    lable: '加余额',\n                    value: 0\n                }, {\n                    lable: '挂帐',\n                    value: 1\n                }\n            ],\n            props: {\n                lazy: true,\n                lazyLoad(node, resolve) {\n                    const {level} = node;\n                    console.log(level,node)\n                    if (level === 0) {\n                        getBrand().then(res => {\n                            var data = res.data;\n\n                            let nodes = [];\n                            for (let i = 0; i < data.length; i++) {\n                                nodes.push({label: data[i].name, value: data[i].brandid});\n                            }\n                            resolve(nodes);\n                        });\n\n                        // 通过调用resolve将子节点数据返回，通知组件数据加载完成\n                    }\n                    if (level === 1) {\n                        getSeries(node.data.value).then(res => {\n                            var data = res.data;\n                            let nodes = [];\n                            for (let i = 0; i < data.length; i++) {\n                                nodes.push({\n                                    label: data[i].factory_name + \" \" + data[i].series_name,\n                                    value: data[i].series_id\n                                });\n                            }\n                            resolve(nodes);\n                        });\n\n                        // 通过调用resolve将子节点数据返回，通知组件数据加载完成\n                    }\n\n                    if (level === 2) {\n                        getModel(node.data.value).then(res => {\n                            var data = res.data;\n                            let nodes = [];\n                            for (let i = 0; i < data.length; i++) {\n                                nodes.push({\n                                    label: data[i].label,\n                                    value: data[i].value,\n                                    leaf: level >= 2\n                                });\n                            }\n                            resolve(nodes);\n                        });\n\n                        // 通过调用resolve将子节点数据返回，通知组件数据加载完成\n                    }\n                    if (level === 3) {\n                        let nodes = [];\n                        resolve(nodes);\n                    }\n                }\n            },\n            adminll: [],\n            shopname: \"\",\n            shopQuery: {\n                cityCode: undefined,\n                shopname: undefined,\n                page: 1,\n                limit: 10,\n                tel: undefined\n            },\n            innerVisible: false,\n            // dialogVisible: false,\n            checked: true,\n            tableKey: 0,\n            CarModellist: [], //车型数据\n            lazada: [], //所有平台\n            salesman: [], //所有业务员\n            holder: [\n                {\n                    label: \"无\",\n                    value: \"无\"\n                },\n                {\n                    label: \"解码器\",\n                    value: \"解码器\"\n                },\n                {\n                    label: \"解码线组\",\n                    value: \"解码线组\"\n                },\n                {\n                    label: \"宝典到店\",\n                    value: \"宝典到店\"\n                }\n            ], //支架\n            ygj: [\n                {\n                    label: \"无\",\n                    value: \"无\"\n                },\n                {\n                    label: \"随货发\",\n                    value: \"随货发\"\n                },\n                {\n                    label: \"供应商代发\",\n                    value: \"供应商代发\"\n                },\n                {\n                    label: \"支架\",\n                    value: \"支架\"\n                }\n            ], //易改件\n            device: [], //装置罩\n            carl: [],\n            list: null,\n            total: null,\n\n            // postFrom: Object.assign({}, defaultForm),\n            cityoptions: [], //地址\n            selectedRows: null,\n            listLoading: true,\n            showSearch: false,\n            options: [],\n            shop: [],\n            shoplist: [],\n            shoptotal: 0,\n            listQuery: {\n                page: 1,\n                limit: 10,\n                status: \"-1\",\n                title: \"\"\n            },\n            buttonDisabled: true,\n            deleting: false,\n            pickerOptions: pickerOptions,\n            currentIndex: -1,\n            productTree: [],\n            regionHiera: [],\n            rules: {\n                openid: [\n                    {required: true, trigger: \"blur\"}\n                    // {min: 2, max: 140, message: '长度在 2 到 140 个字符', trigger: 'blur'}\n                ],\n                buy_account: [{required: true, trigger: \"blur\"}],\n                lazada_list: [{required: true, trigger: \"blur\"}],\n                buy_product_id: [{required: true, trigger: \"blur\"}],\n                no_price: [{required: true, trigger: \"blur\"}],\n                contact: [{required: true, trigger: \"blur\"}],\n                tel: [{required: true, trigger: \"blur\"}],\n                city_code: [{required: true, trigger: \"blur\"}],\n                city_desc: [{required: true, trigger: \"blur\"}],\n                number_plate: [{required: true, trigger: \"blur\"}],\n                car_model: [{required: true, trigger: \"blur\"}],\n                buy_order_no: [{required: true, trigger: \"blur\"}],\n                shop_id: [{required: true, trigger: \"blur\"}],\n                shop_tel: [{required: true, trigger: \"blur\"}],\n                ins_cost: [{required: true, trigger: \"blur\"}]\n            }\n        };\n    },\n    computed: {\n        ...mapGetters([\"userinfo\", \"brand\"])\n    },\n    components: {\n        ShList\n    },\n    props: {\n        postFrom: {\n            type: Object,\n            default: function () {\n                return Object.assign({}, defaultForm);\n            }\n        },\n        Stitle: {\n            type: String,\n            default: \"\"\n        },\n        is_disabled: {\n            type: Boolean,\n            default: false\n        },\n        dialogVisible: {\n            type: Boolean,\n            default: false\n        }\n    },\n    created() {\n\n        adminall().then(res => {\n            this.adminll = res.data;\n        });\n        Citylist().then(res => {\n            this.cityoptions = res.data;\n        });\n        this.shopList();\n\n        GetProductByTree().then(res => {\n            this.productTree = res.data;\n        });\n        GetecshopByList().then(res => {\n            this.lazada = res.data;\n        });\n\n        GetSaleByAll().then(res => {\n            this.salesman = res.data;\n        });\n        let city_code = this.postFrom.city_code;\n        for (let i = 0; i < city_code.length; i++) {\n            city_code[i] = parseInt(city_code[i]);\n        }\n        this.postFrom.city_code = city_code;\n        if (this.postFrom.status === \"待处理\") {\n            this.postFrom.pre_sales = this.userinfo.id;\n        }\n        if(this.postFrom.car_model!==undefined){\n            let e=this.postFrom.car_model;\n            let model_id = e[e.length - 1];\n            if (model_id !== undefined) {\n\n                GetCarlampInfo(model_id).then(res => {\n                    this.postFrom.holder_text = res.data.holder;\n                    this.postFrom.ygj_text = res.data.ygj;\n                    this.postFrom.code_text = res.data.is_code;\n                    this.postFrom.decorate_text = res.data.decorate_text;\n                    this.postFrom.in_the_text = res.data.in_the;\n                    this.postFrom.low_beam_text = res.data.low_beam;\n                })\n            } else {\n            }\n        }\n        console.log(this.postFrom.car_model)\n\n\n    },\n    methods: {\n\n        handleImg(img) {\n            openWindow(img, '图片预览', '500', '400')\n        },\n        elCascaderOnlick() {\n            let that = this;\n            setTimeout(function () {\n                document.querySelectorAll(\".el-cascader-node__label\").forEach(el => {\n                    el.onclick = function () {\n                        this.previousElementSibling.click();\n                        that.$refs.elcascader.dropDownVisible = false;\n                    };\n                });\n                document\n                    .querySelectorAll(\".el-cascader-panel .el-radio\")\n                    .forEach(el => {\n                        el.onclick = function () {\n                            that.$refs.elcascader.dropDownVisible = false;\n                        };\n                    });\n            }, 100);\n        },\n        handelSale(e) {\n            if (e) {\n                this.postFrom.salesman_id = undefined;\n            }\n        },\n        handleSizeChange(val) {\n            this.shopQuery.limit = val;\n            this.shopList();\n        },\n\n        handleStatusChange(val) {\n            this.shopQuery.page = 1;\n\n            this.shopList();\n        },\n        handleCurrentChange(val) {\n            this.shopQuery.page = val;\n            this.shopList();\n        },\n        handleModel(e) {\n            let model_id = e[e.length - 1];\n            if (model_id !== undefined) {\n                GetModelIdByInfo(model_id).then(res => {\n                    this.postFrom.holder_text = res.data[0].holder;\n                    this.postFrom.ygj_text = res.data[0].ygj;\n                    this.postFrom.code_text = res.data[0].is_code;\n                    this.postFrom.decorate_text = res.data[0].decorate_text;\n                    this.postFrom.in_the_text = res.data[0].in_the;\n                    this.postFrom.low_beam_text = res.data[0].low_beam;\n\n                })\n            } else {\n                this.list = [];\n            }\n        },\n        shopList() {\n            GetDataByList(this.shopQuery).then(response => {\n                this.shoplist = response.data.data;\n                this.shoptotal = response.data.total;\n            });\n        },\n        handelToshop(row) {\n            this.postFrom.shop_id = parseInt(row.id);\n            var temp = {\n                shop_id: row.id\n            };\n            GetDataByShopAll(temp).then(res => {\n                this.shop = res.data;\n            });\n            this.postFrom.shop_location = row.cityName + \" \" + row.location;\n            this.postFrom.shop_tel = row.tel;\n            this.postFrom.buildarc = row.buildarc;\n            this.postFrom.to_hang = row.to_hang;\n\n            this.innerVisible = !this.innerVisible;\n        },\n\n        handelInn() {\n            this.shop = [];\n            this.innerVisible = !this.innerVisible;\n            this.shopQuery.cityCode = this.postFrom.city_code;\n        },\n        //所选门店\n\n        handleClose() {\n            this.$emit(\"handleClose\");\n        },\n        updateRow(type = 0) {\n            this.$refs[\"postFrom\"].validate(valid => {\n                console.log(valid);\n                if (!valid) {\n                    this.$message.error(\"请检查必填项\");\n                    return true;\n                }\n            });\n            var arr = this.postFrom;\n            if (this.postFrom.car_model.length === 0) {\n                this.$message.error(\"车型未选\");\n                return true;\n            }\n\n\n            if (this.postFrom.city_code.length === 0) {\n                this.$message.error(\"地址未选\");\n                return true;\n            }\n\n            if (this.postFrom.lazada_list.length === 0) {\n                this.$message.error(\"平台未选\");\n                return true;\n            }\n\n            if (this.postFrom.buy_product_id.length === 0) {\n                this.$message.error(\"产品未选\");\n                return true;\n            }\n\n            if (this.postFrom.buy_product_id.length === 0) {\n                this.$message.error(\"产品未选\");\n                return true;\n            }\n            if (!this.postFrom.is_sale) {\n                if (\n                    this.postFrom.salesman_id === 0 ||\n                    this.postFrom.salesman_id.length === 0\n                ) {\n                    this.$message.error(\"请先选择业务员\");\n                    return true;\n                }\n            }\n            this.postFrom.brand_id = this.postFrom.car_model[0]\n            this.postFrom.series_id = this.postFrom.car_model[1]\n            this.postFrom.model_id = this.postFrom.car_model[2]\n\n\n            this.postFrom.suit_id = this.postFrom.buy_product_id[0]\n\n            this.postFrom.product_id = this.postFrom.buy_product_id[1]\n\n\n            this.postFrom.city_code = this.postFrom.city_code.join(\",\");\n            this.postFrom.car_model = this.postFrom.car_model.join(\",\");\n            this.postFrom.lazada_list = this.postFrom.lazada_list.join(\",\");\n            this.postFrom.buy_product_id = this.postFrom.buy_product_id.join(\",\");\n            if (this.postFrom.status === \"待处理\") {\n                this.postFrom.status = 1;\n                this.postFrom.pre_sales = this.userinfo.id;\n                this.postFrom.logcontent =\n                    \"待确认(业务员)\" +\n                    \" \" +\n                    this.userinfo.realName +\n                    \"派单 ,\" +\n                    \" \" +\n                    \"已通知\";\n            }\n            if (this.postFrom.status === \"重新派单\") {\n                this.postFrom.status = 1;\n                this.postFrom.logcontent =\n                    \"待确认(业务员)\" +\n                    \" \" +\n                    this.userinfo.realName +\n                    \"派单, \" +\n                    \" \" +\n                    \"已通知\";\n            }\n            if (this.postFrom.status === \"待确认(业务)\") {\n                this.postFrom.status = 2;\n                this.postFrom.logcontent =\n                    \"待确认(门店)\" + \" \" + this.userinfo.realName + \"同意派单,\";\n            }\n\n            if (this.postFrom.status === \"待确认(门店)\") {\n                this.postFrom.status = 3;\n                this.postFrom.logcontent =\n                    \"待安装\" + \" \" + this.userinfo.realName + \"接单,\";\n            }\n            if (this.postFrom.status === \"待安装\") {\n                this.postFrom.status = 4;\n\n                this.postFrom.logcontent =\n                    \"已安装\" + \" \" + this.userinfo.realName + \"安装完成,\";\n            }\n            if (this.postFrom.status === \"已安装\") {\n                this.postFrom.status = 5;\n                this.postFrom.after_sale = this.userinfo.id;\n                this.postFrom.logcontent =\n                    \"财审1\" + \" \" + this.userinfo.realName + \"确认安装,\";\n            }\n            if (this.postFrom.status === \"财审1\") {\n                this.postFrom.status = 6;\n                this.postFrom.logcontent =\n                    \"财审2\" + \" \" + this.userinfo.realName + \"审核通过,\";\n            }\n            if (this.postFrom.status === \"财审2\") {\n                this.postFrom.status = 7;\n                this.postFrom.logcontent =\n                    \"待结算\" + \" \" + this.userinfo.realName + \"结算通过,\";\n            }\n            if (this.postFrom.status === \"待结算\") {\n                this.postFrom.status = 8;\n                this.postFrom.is_pay = type;\n                if (type === 1) {\n                    this.postFrom.logcontent =\n                        \"已结算\" + \" \" + this.userinfo.realName + \"加余额,\";\n                }\n                if (type === 2) {\n                    this.postFrom.logcontent =\n                        \"已结算\" + \" \" + this.userinfo.realName + \"抵欠款,\";\n                }\n            }\n\n            if (this.postFrom.status === \"修改\") {\n                this.postFrom.is_di = 1;\n                this.postFrom.logcontent = this.userinfo.realName + \"进行了订单修改,\";\n            }\n\n            if (this.postFrom.is_sale && this.postFrom.status === 1) {\n                this.postFrom.status = 2;\n                this.postFrom.logcontent =\n                    \"待确认(门店)\" + \" \" + this.userinfo.realName + \"同意派单,\";\n            }\n\n            PostDataByAdd(this.postFrom).then(res => {\n                this.$emit(\"handleClose\");\n\n                this.postFrom = Object.assign({}, defaultForm);\n                this.postFrom = arr;\n                this.$message.success(\"操作完成\");\n            });\n        }\n    },\n    mounted() {\n        if (this.postFrom.is_sale === 1) {\n            this.postFrom.is_sale = true;\n        } else {\n            this.postFrom.is_sale = false;\n        }\n        var temp = {\n            shop_id: this.postFrom.shop_id\n        };\n        GetDataByShopAll(temp).then(res => {\n            this.shop = res.data;\n        });\n    }\n};\n",null]}