{"remainingRequest":"/Users/liangzexiang/WebstormProjects/ays/node_modules/thread-loader/dist/cjs.js!/Users/liangzexiang/WebstormProjects/ays/node_modules/babel-loader/lib/index.js!/Users/liangzexiang/WebstormProjects/ays/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/liangzexiang/WebstormProjects/ays/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/liangzexiang/WebstormProjects/ays/src/views/cost/operate.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/liangzexiang/WebstormProjects/ays/src/views/cost/operate.vue","mtime":1596991000384},{"path":"/Users/liangzexiang/WebstormProjects/ays/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liangzexiang/WebstormProjects/ays/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liangzexiang/WebstormProjects/ays/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/liangzexiang/WebstormProjects/ays/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liangzexiang/WebstormProjects/ays/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.regexp.split\";\nimport _objectSpread from \"/Users/liangzexiang/WebstormProjects/ays/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread2\";\nimport _defineProperty from \"/Users/liangzexiang/WebstormProjects/ays/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar app0;\nimport { change, changeAll, del, delAll, GetDataByList, GetQueryBydownload, PostDataByAdd, PostNoteByAdd, PostReturnedByAdd } from '@/api/costorder';\nimport waves from '@/directive/waves';\nimport { getArrByKey, pickerOptions } from '@/utils';\nimport { mapGetters } from 'vuex'; // import sendOrder from \"./install/sendOrder\";\n\nimport sendOper from \"./install/sendOper\"; // import OrderInfo from \"./install/OrderInfo\";\n\nimport OrderInfocost from \"./install/OrderInfocost\";\nimport Audit from \"./install/costaudit\";\nimport { CarBrand } from '@/api/tools';\nimport { GetecshopByList } from '@/api/ecshop';\nimport { GetDataByShopAll } from '@/api/shop';\nimport { GetSaleByAll } from '@/api/salesman';\nimport { regionDataPlus } from 'element-china-area-data';\nexport default {\n  name: 'Operate',\n  // components: { rolesForm },\n  directives: {\n    waves: waves\n  },\n  components: {\n    sendOper: sendOper,\n    OrderInfocost: OrderInfocost,\n    Audit: Audit\n  },\n  filters: {\n    statusFilter: function statusFilter(status) {\n      var statusMap = {\n        0: '禁用',\n        1: '正常'\n      };\n      return statusMap[status];\n    }\n  },\n  data: function data() {\n    var _ref;\n\n    return _ref = {\n      isIndeterminate: true,\n      checkedCities: [],\n      // 已选择\n      checkAll: false,\n      dialogAudit: false,\n      loading: true,\n      sumorder: 0,\n      productTree: [],\n      // 产品树\n      reTitle: '',\n      reFrom: {\n        role: 2,\n        type: 1\n      },\n      after: [{\n        lable: '已售后',\n        value: 1\n      }, {\n        lable: '未售后',\n        value: 2\n      }],\n      orderStatus: [{\n        lable: '全部',\n        value: 'all'\n      }, {\n        lable: '待初审',\n        value: 1\n      }, {\n        lable: '待财审1',\n        value: 2\n      }, {\n        lable: '待财审2',\n        value: 3\n      }, {\n        lable: '待结算',\n        value: 4\n      }, {\n        lable: '已结算',\n        value: 5\n      }, {\n        lable: '驳回',\n        value: 6,\n        total: 0\n      }],\n      visit: [{\n        lable: '已回访',\n        value: 1\n      }, {\n        lable: '未回访',\n        value: 2\n      }],\n      infodialogVisible: false,\n      // 打开详情\n      reOption: [],\n      is_disabled: false,\n      shopQuery: {\n        cityCode: undefined,\n        shopname: undefined,\n        tel: undefined\n      },\n      postFrom: {},\n      permissions: [],\n      // 权限组\n      RedialogVisible: false,\n      ReturndialogVisible: false,\n      ReturnData: {\n        type: 1,\n        price: undefined,\n        courier: undefined,\n        courier_order_no: undefined,\n        name: undefined\n      },\n      innerVisible: false,\n      dialogVisible: false,\n      checked: true,\n      tableKey: 0,\n      order_id: undefined,\n      CarModellist: [],\n      // 车型数据\n      lazada: [],\n      // 所有平台\n      salesman: [],\n      // 所有业务员\n      device: [],\n      // 装置罩\n      carl: [],\n      list: null,\n      total: 0,\n      // postFrom: Object.assign({}, defaultForm),\n      cityoptions: regionDataPlus,\n      // 地址\n      selectedRows: null,\n      listLoading: true,\n      showSearch: false\n    }, _defineProperty(_ref, \"order_id\", undefined), _defineProperty(_ref, \"options\", []), _defineProperty(_ref, \"shop\", []), _defineProperty(_ref, \"listQuery\", {\n      page: 1,\n      limit: 10,\n      status: 'all',\n      title: '',\n      sstatus: 'all'\n    }), _defineProperty(_ref, \"allsum\", 0), _defineProperty(_ref, \"countdata\", [{\n      total: 1,\n      status: 1\n    }, {\n      total: 1,\n      status: 1\n    }, {\n      total: 1,\n      status: 1\n    }, {\n      total: 1,\n      status: 1\n    }, {\n      total: 1,\n      status: 1\n    }, {\n      total: 1,\n      status: 1\n    }, {\n      total: 1,\n      status: 1\n    }]), _defineProperty(_ref, \"buttonDisabled\", true), _defineProperty(_ref, \"deleting\", false), _defineProperty(_ref, \"pickerOptions\", pickerOptions), _defineProperty(_ref, \"currentIndex\", -1), _defineProperty(_ref, \"regionHiera\", []), _defineProperty(_ref, \"Stitle\", ''), _defineProperty(_ref, \"checklist\", []), _ref;\n  },\n  computed: _objectSpread({}, mapGetters(['userinfo', 'brand', 'group'])),\n  watch: {},\n  created: function created() {\n    var _this2 = this;\n\n    this.permissions = this.group.btn.split(',');\n    this.fetchList();\n\n    if (this.brand === undefined) {\n      CarBrand().then(function (res) {\n        _this2.regionHiera = res.data;\n      });\n    } else {\n      this.regionHiera = this.brand;\n    }\n\n    GetecshopByList().then(function (res) {\n      _this2.lazada = res.data;\n    });\n    console.log(this.userinfo); // 产品树\n\n    GetDataByShopAll().then(function (res) {\n      _this2.shop = res.data;\n    });\n    GetSaleByAll().then(function (res) {\n      _this2.salesman = res.data;\n    });\n  },\n  methods: {\n    handelcheck: function handelcheck(e) {\n      var index = this.checklist.indexOf(e);\n      console.log(index);\n\n      if (index === -1) {\n        this.checklist.push(e);\n      } else {\n        this.checklist.splice(index, 1);\n      }\n\n      if (this.checklist.length === this.list.length) {\n        this.isIndeterminate = true;\n        this.checkAll = true;\n      }\n    },\n    handleCheckAllChange: function handleCheckAllChange(val) {\n      this.checkedCities = this.list.length ? this.checklist.length : [];\n      this.isIndeterminate = false;\n    },\n    handleCheckedCitiesChange: function handleCheckedCitiesChange(value) {\n      var checkedCount = value.length;\n      this.checkAll = checkedCount === this.cities.length;\n      this.isIndeterminate = checkedCount > 0 && checkedCount < this.cities.length;\n    },\n    handleCloseAudit: function handleCloseAudit() {\n      this.dialogAudit = false;\n      this.fetchList();\n    },\n    handeReturn: function handeReturn() {\n      var _this3 = this;\n\n      // this.$message('暂未编写退货逻辑')\n      this.ReturnData.order_id = this.order_id;\n      PostReturnedByAdd(this.ReturnData).then(function (res) {\n        _this3.ReturndialogVisible = !_this3.ReturndialogVisible;\n\n        _this3.fetchList();\n      });\n    },\n    // 导出数据\n    handleDownload: function handleDownload() {\n      var _this4 = this;\n\n      // this.downloadLoading = true\n      GetQueryBydownload(this.listQuery).then(function (res) {\n        import('@/vendor/Export2Excel').then(function (excel) {\n          console.log(excel);\n          var tHeader = ['安装单号', '订单状态', '购买平台', '购买单号', '购买账号', '购买产品', '订单金额', '联系人', '联系电话', '省', '市', '区', '详细地址', '车牌号', '车型', '备注', '提交时间', '门店类别', '门店状态', '有无宝典', '门店名称', '门店地址', '门店电话', '安装费用', '主业务员', '次业务员', '客服', '客服备注', '派单时间', '业务确认时间', '门店确认时间', '安装完成时间', '结算时间', '结算方式', '是否驳回', '驳回原因', '回访', '售后'];\n          var filterVal = ['id', 'status', 'lazada_title', 'buy_order_no', 'buy_account', 'product_titile', 'no_price', 'contact', 'tel', 'city_province', 'city_city', 'city_carea', 'city_desc', 'number_plate', 'model_title', 'desc', 'create_time', 'shop_type', 'shop_status', 'is_book', 'shop_name', 'shop_city', 'shop_tel', 'ins_cost', 'sales_name', 'insales_name', 'pre_name', 'service_desc', 'send_time', 'business_time', 'stores_time', 'install_time', 'settlement_time', 'settlement_type', 'is_rejected', 'rejected_txt', 'return', 'after_sales'];\n\n          var data = _this4.formatJson(res.data.data, filterVal);\n\n          var day2 = new Date();\n          day2.setTime(day2.getTime());\n          var s2 = day2.getFullYear() + '-' + (day2.getMonth() + 1) + '-' + day2.getDate();\n          excel.export_json_to_excel({\n            header: tHeader,\n            data: data,\n            filename: s2\n          });\n          _this4.downloadLoading = false;\n        });\n      });\n    },\n    formatJson: function formatJson(data, filterVal) {\n      return data.map(function (v) {\n        return filterVal.map(function (j) {\n          if (j === 'timestamp') {\n            return parseTime(v[j]);\n          } else {\n            return v[j];\n          }\n        });\n      });\n    },\n    handleReturn: function handleReturn(row) {\n      this.ReturndialogVisible = !this.ReturndialogVisible;\n      this.reTitle = row.id + ' ' + '退货操作';\n      this.order_id = row.id;\n    },\n    handleRe: function handleRe() {\n      this.RedialogVisible = !this.RedialogVisible;\n    },\n    rolesbtn: function rolesbtn(val) {\n      var index = this.permissions.indexOf(val);\n\n      if (index > -1) {\n        return true;\n      } else {\n        return false;\n      }\n    },\n    handeldownload: function handeldownload() {\n      this.$message('暂无导出');\n    },\n    handelInfoDialog: function handelInfoDialog() {\n      this.infodialogVisible = !this.infodialogVisible;\n    },\n    // 打开详情\n    handelInfo: function handelInfo(row) {\n      this.postFrom = row; // if (row.city_code.constructor === String) {\n      //   this.postFrom.city_code = this.postFrom.city_code.split(\",\");\n      // }\n      // if (row.car_model.constructor === String) {\n      //   this.postFrom.car_model = this.postFrom.car_model.split(\",\");\n      // }\n      // if (row.lazada_list.constructor === String) {\n      //   this.postFrom.lazada_list = this.postFrom.lazada_list.split(\",\");\n      // }\n      // let lazada = this.postFrom.lazada_list;\n      // this.postFrom.lazada_list = [];\n      // for (let i = 0; i < lazada.length; i++) {\n      //   this.postFrom.lazada_list.push(parseInt(lazada[i]));\n      // }\n\n      this.infodialogVisible = !this.infodialogVisible;\n    },\n    handelPostRe: function handelPostRe() {\n      var _this5 = this;\n\n      this.reFrom.admin_id = this.userinfo.id;\n      this.reFrom.tocontent = '订单驳回' + '  ' + this.userinfo.realName + '-' + this.userinfo.group.title + ' 驳回订单,' + ' ' + this.reFrom.content;\n      PostNoteByAdd(this.reFrom).then(function (res) {\n        _this5.fetchList();\n\n        _this5.RedialogVisible = !_this5.RedialogVisible;\n      });\n    },\n    // 驳回\n    handelRejected: function handelRejected(row) {\n      var type = row.status;\n      this.RedialogVisible = !this.RedialogVisible;\n      this.reFrom.order_id = row.id;\n      this.reFrom.model_title = row.model_title;\n      this.reFrom.product_titile = row.product_titile;\n      this.reFrom.shopname = row.shop.shopname;\n      this.reFrom.admin_name = this.userinfo.realName;\n      this.reFrom.openid = row.openid;\n      this.reFrom.rejected = row.status;\n      this.reFrom.salesman_id = row.salesman_id;\n      this.reTitle = row.id + '-' + row.status + ' ' + '驳回原因';\n      var option = [];\n      this.reOption = option;\n    },\n    // 所选门店\n    fetchList: function fetchList() {\n      var _this6 = this;\n\n      this.listLoading = true;\n      GetDataByList(this.listQuery).then(function (response) {\n        _this6.list = response.data.data;\n        console.log(response.data.data, 'shuju');\n        _this6.total = response.data.total;\n        var countdata = response.data.countdata;\n        console.log(countdata);\n        var temp = [];\n        var allsum = 0;\n\n        for (var i = 0; i < 13; i++) {\n          temp.push({\n            total: 0,\n            status: i\n          });\n        }\n\n        for (var _i = 0; _i < countdata.length; _i++) {\n          allsum = allsum + countdata[_i].total;\n          temp[countdata[_i].status].total = countdata[_i].total;\n\n          if (countdata[_i].status === 9) {\n            if (temp[0].total === 0) {\n              temp[0].total = countdata[_i].total;\n            } else {\n              temp[0].total = temp[0].total + countdata[_i].total;\n            }\n          }\n        }\n\n        _this6.listLoading = !_this6.listLoading;\n        _this6.allsum = allsum;\n        _this6.countdata = temp;\n        _this6.listLoading = false;\n      });\n    },\n    handleFilter: function handleFilter() {\n      this.listQuery.page = 1;\n      this.fetchList();\n    },\n    handleFilterClear: function handleFilterClear() {\n      this.listQuery = {\n        page: 1,\n        psize: 10,\n        status: '-1',\n        title: ''\n      };\n      this.fetchList();\n    },\n    handleSizeChange: function handleSizeChange(val) {\n      this.listQuery.psize = val;\n      this.fetchList();\n    },\n    handleStatusChange: function handleStatusChange(val) {\n      this.listQuery.page = 1;\n      this.listQuery.sstatus = val;\n      this.fetchList();\n    },\n    handleCurrentChange: function handleCurrentChange(val) {\n      this.listQuery.page = val;\n      this.fetchList();\n    },\n    handleModifyStatus: function handleModifyStatus(index, id, status) {\n      this.list[index]['status'] = 1 - status;\n      change(id, 'status', 1 - status).then(function (response) {});\n    },\n    handleSelectionChange: function handleSelectionChange(val) {\n      if (val.length > 0) {\n        this.buttonDisabled = false;\n      } else {\n        this.buttonDisabled = true;\n      }\n\n      this.selectedRows = val;\n    },\n    handleCreate: function handleCreate() {\n      this.postFrom = {};\n      this.is_disabled = false;\n      this.Stitle = '新增支付单';\n      this.postFrom.status = '待初审';\n      this.dialogVisible = !this.dialogVisible;\n    },\n    handleUpdate: function handleUpdate(row) {\n      this.postFrom = {};\n      this.postFrom = row;\n      this.is_disabled = false;\n\n      if (this.postFrom.status === '驳回') {\n        this.postFrom.status = '重新派单';\n      }\n\n      this.Stitle = this.postFrom.id + '-' + this.postFrom.status + '操作';\n      this.dialogAudit = !this.dialogAudit;\n    },\n    handleEdit: function handleEdit(row) {\n      this.postFrom = {};\n      this.postFrom = row;\n      this.is_disabled = false;\n\n      if (this.postFrom.status === '驳回') {\n        this.postFrom.status = '重新派单';\n      }\n\n      if (row.lazada_list.constructor === String) {\n        this.postFrom.lazada_list = this.postFrom.lazada_list.split(\",\");\n      }\n\n      var lazada_list = [];\n      this.postFrom.lazada_list.forEach(function (item) {\n        lazada_list.push(parseInt(item));\n      });\n      this.postFrom.lazada_list = lazada_list;\n      console.log(this.postFrom.lazada_list);\n      this.postFrom.status = '修改';\n      this.postFrom.imglist = this.postFrom.imglist.split(',');\n      var img = [];\n      this.postFrom.imglist.forEach(function (item) {\n        img.push({\n          url: item\n        });\n      });\n      this.postFrom.imglist = img;\n      this.Stitle = '修改操作';\n      console.log(this.postFrom);\n      this.dialogVisible = !this.dialogVisible;\n    },\n    handleClose: function handleClose() {\n      this.dialogVisible = !this.dialogVisible;\n      this.fetchList();\n    },\n    handleDelete: function handleDelete(index, id) {\n      var _this7 = this;\n\n      var _this = this;\n\n      this.$confirm('此操作将永久删除该记录, 是否继续?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function () {\n        _this.$set(_this.list[index], 'delete', true);\n\n        del(id).then(function (response) {\n          if (response.status === 1) {\n            _this.list.splice(index, 1);\n\n            _this.total = _this.total - 1;\n\n            _this.$notify.success(response.msg);\n\n            _this7.fetchList();\n          } else {\n            _this.$notify.error('删除成功');\n          }\n\n          _this.$notify.error('删除成功');\n\n          _this.$set(_this.list[index], 'delete', false);\n        }).catch(function (error) {\n          _this.$set(_this.list[index], 'delete', false);\n        });\n      }).catch(function () {\n        _this7.$message({\n          type: 'info',\n          message: '已取消删除'\n        });\n      });\n    },\n    handleDeleteAll: function handleDeleteAll() {\n      var _this8 = this;\n\n      var _this = this;\n\n      if (this.selectedRows.length > 0) {\n        this.$confirm('此操作将永久删除该记录, 是否继续?', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(function () {\n          _this.deleting = true;\n          var ids = getArrByKey(_this.selectedRows, 'id');\n          var idstr = ids.join(',');\n          delAll({\n            ids: idstr\n          }).then(function (response) {\n            if (response.status === 1) {\n              var delindex = [];\n\n              _this.list.forEach(function (item, index, input) {\n                if (ids.indexOf(item.id) > -1) {\n                  delindex.push(index);\n                }\n              });\n\n              for (var i = delindex.length - 1; i >= 0; i--) {\n                _this.list.splice(delindex[i], 1);\n              }\n\n              _this.total = _this.total - delindex.length;\n\n              _this.$message.success(response.msg);\n            } else {\n              _this.$message.error(response.msg);\n            }\n\n            _this.deleting = false;\n          }).catch(function (error) {\n            _this.deleting = false;\n          });\n        }).catch(function () {\n          _this8.$message({\n            type: 'info',\n            message: '已取消删除'\n          });\n        });\n      } else {\n        _this.$message.error('请选择要删除的数据');\n      }\n    },\n    handleCommand: function handleCommand(command) {\n      var _this = this;\n\n      if (this.selectedRows.length > 0) {\n        var ids = getArrByKey(this.selectedRows, 'id');\n        var idstr = ids.join(',');\n        changeAll({\n          val: idstr,\n          field: 'status',\n          value: command\n        }).then(function (response) {\n          if (response.status === 1) {\n            _this.list.forEach(function (item, index, input) {\n              if (ids.indexOf(item.id) > -1) {\n                _this.list[index]['status'] = command;\n              }\n            });\n\n            _this.$message.success(response.msg);\n          } else {\n            _this.$message.error(response.msg);\n          }\n        }).catch(function (error) {});\n      } else {\n        _this.$message.error('请选择要操作的数据');\n      }\n    }\n  }\n};",null]}