{"remainingRequest":"/Users/liangzexiang/WebstormProjects/ays/node_modules/thread-loader/dist/cjs.js!/Users/liangzexiang/WebstormProjects/ays/node_modules/babel-loader/lib/index.js!/Users/liangzexiang/WebstormProjects/ays/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/liangzexiang/WebstormProjects/ays/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/liangzexiang/WebstormProjects/ays/src/views/manage/admin/form.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/liangzexiang/WebstormProjects/ays/src/views/manage/admin/form.vue","mtime":1587402564000},{"path":"/Users/liangzexiang/WebstormProjects/ays/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liangzexiang/WebstormProjects/ays/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liangzexiang/WebstormProjects/ays/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/liangzexiang/WebstormProjects/ays/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liangzexiang/WebstormProjects/ays/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _typeof from \"/Users/liangzexiang/WebstormProjects/ays/node_modules/@babel/runtime-corejs2/helpers/esm/typeof\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n// import Upload from '@/components/Upload/oneImage'\nimport { getListAll } from '@/api/roles';\nimport { getinfo, save } from '@/api/admin';\nimport { formatImgToArr, getNowTime } from '@/utils';\nimport { validatePhone, validateEmail } from '@/utils/validate';\nimport myconfig from '@/config';\nexport default {\n  name: 'AdminForm',\n  // components: { Upload },\n  data: function data() {\n    var checkEmail = function checkEmail(rule, value, callback) {\n      if (validateEmail(value)) {\n        callback();\n      } else {\n        return callback(new Error());\n      }\n    };\n\n    return {\n      btnLoading: false,\n      roles: {},\n      temp: {\n        id: 0,\n        groupId: '',\n        userName: '',\n        password: '',\n        realName: '',\n        isEnabled: 1,\n        phone: '',\n        email: '',\n        regTime: getNowTime(),\n        img: ''\n      },\n      oss_url: '',\n      config: {\n        fileName: 'img',\n        limit: 1,\n        multiple: true,\n        accept: 'image/*',\n        action: myconfig.uploadUrl.img\n      },\n      dialogFormVisible: false,\n      dialogStatus: '',\n      textMap: {\n        update: '编辑',\n        create: '添加'\n      },\n      rules: {\n        groupId: [{\n          required: true,\n          message: '角色必选',\n          trigger: 'change'\n        }],\n        userName: [{\n          required: true,\n          message: '账号必填',\n          trigger: 'blur'\n        }],\n        // phone: [{ validator: checkPhone, message: '手机号格式错误', trigger: 'blur' }],\n        email: [{\n          validator: checkEmail,\n          message: '邮箱格式错误',\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n  watch: {\n    dialogFormVisible: function dialogFormVisible() {\n      this.resetTemp();\n    },\n    temp: {\n      handler: function handler(newVal, oldVal) {},\n      immediate: true,\n      deep: true\n    }\n  },\n  created: function created() {\n    this.getRoles();\n  },\n  destroyed: function destroyed() {},\n  methods: {\n    handelFile: function handelFile(e) {\n      var _this = this;\n\n      _this.temp.img = e.file.url;\n    },\n    getRoles: function getRoles() {\n      var _this2 = this;\n\n      getListAll().then(function (response) {\n        _this2.roles = response.data;\n      });\n    },\n    resetTemp: function resetTemp() {\n      this.temp = {\n        id: 0,\n        groupId: '',\n        userName: '',\n        password: '',\n        realName: '',\n        isEnabled: 1,\n        phone: '',\n        email: '',\n        regTime: getNowTime(),\n        img: ''\n      };\n    },\n    handleCreate: function handleCreate() {\n      var _this3 = this;\n\n      this.dialogStatus = 'create';\n      this.dialogFormVisible = true;\n      this.currentIndex = -1;\n      this.$nextTick(function () {\n        _this3.$refs['dataForm'].clearValidate();\n      });\n    },\n    handleUpdate: function handleUpdate(id) {\n      var _this4 = this;\n\n      this.oss_url = myconfig.oss_url;\n      this.dialogStatus = 'update';\n      this.dialogFormVisible = true;\n\n      var _this = this;\n\n      getinfo(id).then(function (response) {\n        if (response.status === 1) {\n          _this.temp.id = response.data.id;\n          _this.temp.groupId = response.data.groupId;\n          _this.temp.userName = response.data.userName;\n          _this.temp.realName = response.data.realName;\n          _this.temp.isEnabled = response.data.isEnabled;\n          _this.temp.phone = response.data.phone;\n          _this.temp.email = response.data.email;\n          _this.temp.password = '';\n          _this.temp.img = response.data.img;\n        }\n      });\n      this.$nextTick(function () {\n        _this4.$refs['dataForm'].clearValidate();\n      });\n    },\n    saveData: function saveData() {\n      var _this5 = this;\n\n      this.btnLoading = true;\n      console.log('更新');\n      this.$refs['dataForm'].validate(function (valid) {\n        if (valid) {\n          var _this = _this5;\n          var d = _this5.temp;\n\n          if (_typeof(d.img) === 'object') {\n            d.img = d.img.join(',');\n          }\n\n          save(d).then(function (response) {\n            if (response.status === 1) {\n              if (!d.id) {\n                d.id = response.data.id;\n              } // todo\n\n\n              _this5.$emit('updateRow', d);\n\n              _this.dialogFormVisible = false;\n\n              _this.$message.success(response.msg);\n            } else {\n              _this.$message.error(response.msg);\n            }\n\n            _this.btnLoading = false;\n          }).catch(function (error) {\n            _this5.btnLoading = false;\n          });\n        } else {\n          _this5.btnLoading = false;\n        }\n      });\n    }\n  }\n};",null]}